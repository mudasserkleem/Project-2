<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guess The Number</title>

<style>

:root {
    --bg: #121212;
    --card: #1f1f1f;
    --text: #ffffff;
    --accent: #4cd137;
}
.light {
    --bg: #f4f4f4;
    --card: #ffffff;
    --text: #000000;
    --accent: #4CAF50;
}
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}
.game-container {
    background: var(--card);
    width: 95%;
    max-width: 360px;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
}
select, input, button {
    width: 100%;
    padding: 12px;
    margin: 6px 0;
    border-radius: 8px;
    border: none;
}
button {
    background: var(--accent);
    color: white;
    cursor: pointer;
}
.toggle {
    background: transparent;
    border: 1px solid var(--text);
}
.stats {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
}
.message {
    margin-top: 10px;
    font-weight: bold;
}
.shake {
    animation: shake 0.3s;
}
@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
    100% { transform: translateX(0); }
}
.win {
    animation: bounce 0.6s;
}
@keyframes bounce {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}
#usernameInput,#passwordInput {
    box-shadow: 0px 0px 50px #2FE8E4;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="game-container" id="loginBox">
    <h1>Account</h1>
    Enter you email:
    <input type="email" id="usernameInput" placeholder="example@xy.com">
    Enter you password:
    <input id="passwordInput" type="password" ondblclick="show()" placeholder="Password">
    <button onclick="register()">Sign up</button>
    <button onclick="login()">Login</button>
    <p id="loginMsg"></p>
</div>

<!-- GAME  -->
<div class="game-container" id="gameBox" style="display:none;">
    <button class="toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
    <h1>Guess The Number</h1>

    <select id="difficulty" onchange="setDifficulty()">
        <option disabled selected>Select Difficulty</option>
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
    </select>

    <p id="rangeText"></p>

    <div class="stats">
        <span>Attempts: <span id="attempts"></span></span>
        <span>‚è±Ô∏è <span id="timer">0</span>s</span>
    </div>

    <div class="stats">
        <span>Score: <span id="score">0</span></span>
        <span>High: <span id="highScore">0</span></span>
    </div>

    <input type="number" id="guessInput" placeholder="Enter your guess">
    <button onclick="enableSound(); checkGuess()">Guess</button>
    <button onclick="enableSound(); resetGame()">Reset</button>

    <p class="message" id="message"></p>
    <a href="README.html">Help</a>
</div>

<!-- AUDIO -->
<audio id="correct" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
<audio id="wrong" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
<audio id="over" src="https://www.soundjay.com/misc/sounds/fail-buzzer-01.mp3"></audio>

<script>
/* üîê AUTH */
let users = JSON.parse(localStorage.getItem("users")) || {};
let currentUser = null;

async function hashPassword(pwd) {
    const data = new TextEncoder().encode(pwd);
    const hash = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,"0")).join("");
}

async function register() {
    const u = usernameInput.value.trim();
    const p = passwordInput.value;
    if (!u || !p) return loginMsg.textContent = "Fill all fields";
    if (users[u]) return loginMsg.textContent = "User exists";

    users[u] = { password: await hashPassword(p), highScore: 0 };
    localStorage.setItem("users", JSON.stringify(users));
    loginMsg.textContent = "Registered! Login now.";
}

async function login() {
    const u = usernameInput.value.trim();
    const p = passwordInput.value;
    if (!users[u]) return loginMsg.textContent = "User not found";

    if (users[u].password !== await hashPassword(p))
        return loginMsg.textContent = "Wrong password";

    currentUser = u;
    highScore = users[u].highScore;
    highScoreSpan.textContent = highScore;

    loginBox.style.display = "none";
    gameBox.style.display = "block";
}
  

/* üéÆ GAME */
let randomNumber, maxNumber, attemptsLeft, score = 0;
let timeLeft = 0, timerInterval = null;
let highScore = 0;

/* üîä SOUND FIX */
let soundEnabled = false;
function enableSound() {
    if (soundEnabled) return;
    [correct, wrong, over].forEach(a => {
        a.volume = 0.5;
        a.play().then(()=>{a.pause(); a.currentTime=0}).catch(()=>{});
    });
    soundEnabled = true;
}
function playSound(a) {
    if (!soundEnabled) return;
    a.currentTime = 0;
    a.play().catch(()=>{});
}

/* ‚è± TIMER FIX */
function startTimer() {
    clearInterval(timerInterval);
    timer.textContent = timeLeft;

    timerInterval = setInterval(() => {
        timeLeft--;
        timer.textContent = timeLeft;
        if (timeLeft <= 0) endGame("‚è±Ô∏è Time's up!");
    }, 1000);
}

function setDifficulty() {
    const d = difficulty.value;
    if (d === "easy") { maxNumber = 50; attemptsLeft = 30; timeLeft = 150; }
    if (d === "medium") { maxNumber = 100; attemptsLeft = 15; timeLeft = 100; }
    if (d === "hard") { maxNumber = 200; attemptsLeft = 10; timeLeft = 50; }

    randomNumber = Math.floor(Math.random()*maxNumber)+1;
    attempts.textContent = attemptsLeft;
    rangeText.textContent = `Guess between 1 and ${maxNumber}`;
    startTimer();
}

function checkGuess() {
    const guess = Number(guessInput.value);
    if (!guess || guess < 1 || guess > maxNumber) return;

    attemptsLeft--;
    attempts.textContent = attemptsLeft;

    if (guess === randomNumber) {
        playSound(correct);
        message.textContent = "üéâ Correct!";
        message.classList.remove("win");
        void message.offsetWidth;
        message.classList.add("win");

        score += 10;
        scoreSpan.textContent = score;
        randomNumber = Math.floor(Math.random()*maxNumber)+1;
        return;
    }

    playSound(wrong);
    gameBox.classList.remove("shake");
    void gameBox.offsetWidth;
    gameBox.classList.add("shake");

    if (attemptsLeft === 0) endGame(`üíÄ Number was ${randomNumber}`);
    else message.textContent = guess < randomNumber ? "Too Low!" : "Too High!";
}

function endGame(text) {
    clearInterval(timerInterval);
    playSound(over);
    message.textContent = text;

    if (score > users[currentUser].highScore) {
        users[currentUser].highScore = score;
        localStorage.setItem("users", JSON.stringify(users));
        highScoreSpan.textContent = score;
    }
}

function resetGame() {
    clearInterval(timerInterval);
    score = 0;
    scoreSpan.textContent = 0;
    message.textContent = "";
    guessInput.value = "";
}

function toggleTheme() {
    document.body.classList.toggle("light");
    localStorage.setItem("theme", document.body.className);
}

document.body.className = localStorage.getItem("theme") || "";

/* DOM shortcuts */
const scoreSpan = document.getElementById("score");
const highScoreSpan = document.getElementById("highScore");
</script>

</body>
</html>